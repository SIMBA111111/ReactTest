name: GitHub Actions Demo
run-name: ${{ github.actor }} is changed project ðŸš€
on: [push]
jobs:
  Clon-repo:
    runs-on: ubuntu-22.04
    steps: 
      - run: echo "Start cloning repo.."
      
      - name: Checkout code
        uses: actions/checkout@v2 
        
      - name: Install dependencies
        run: npm install
        
      - name: Build
        run: npm run build
                
      - name: Create SSH key
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/private.key
          chmod 600 ~/.ssh/private.key

      - name: Check SSH key permissions
        run: ls -l ~/.ssh/private.key

      - name: Add the host to known_hosts
        run: ssh-keyscan -H 89.169.1.160 >> ~/.ssh/known_hosts

      - name: Debug SSH key
        run: |
          echo "First 10 lines of the SSH key:"
          echo "${{ secrets.SSH_PRIVATE_KEY }}" | head -n 10
          echo "Attempting to load the key:"
          ssh-keygen -y -f ~/.ssh/private.key
      
      - name: Deploy
        run: |
          ssh -o StrictHostKeyChecking=no -i ~/.ssh/private.key root@89.169.1.160 "echo 'Deployment successful!'"
